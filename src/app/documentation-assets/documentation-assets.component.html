<section class="documentationBlck">
  <app-loader [show]="loading"></app-loader>
  <div *ngIf="notAuthorize" class="not-authorize">
    <p>You are not authorized to view other construction footage.</p>
    <ul>
      <li>Click <a href="mailto:Neom.Documentation@neom.com?subject=Ground X Construction Footage Request">here</a> to request viewing access to construction footage.</li>
      <li>Click <a href="mailto:groundxsupport@neom.com?subject=Ground X API Access Request">here</a> to request API access to construction footage.</li>
    </ul>
  </div>
  <div *ngIf="!notAuthorize" class="container" style="min-height: 100vh; padding-left: 0px;">
      <h2>Construction footage</h2>
      <h3>{{company}}</h3>
      <!-- <div *ngIf="!loading && (!assetList || assetList.length == 0) && checkNoFilterSelected()" class="adding-assets">
          <img src="../../assets/images/upload-icon.svg" />
          Start adding assets
          <div class="uploadBtn" (click)="openModal()">Upload</div>
      </div> -->

      <div class="masonryBlock">
        <div class="regionBlok">
          <ul>
            <li>
                <ng-select placeholder="Region"
                    (change)="onSelectRegions($event)"
                    [searchable]="true"
                    [clearable]="true"
                    [(ngModel)]="selectedRegion"
                    id="confidentiality"
                    [ngClass]="{'goldenText': selectedRegion}"
                >
                    <ng-option *ngFor="let region of regionList" [value]="region">
                      {{region.initial}} - {{region.name}}
                    </ng-option>
                </ng-select>
            </li>
            <li class="subAreaDropdown">
                <ng-select placeholder="Sub-area"
                    (change)="onSelectSubArea($event)"
                    [searchable]="true"
                    [clearable]="true"
                    [(ngModel)]="selectedsubArea"
                    id="confidentiality"
                    [ngClass]="{'goldenText': selectedsubArea}"
                >
                    <ng-option *ngFor="let subArea of filteredSubAreaList" [value]="subArea">
                      <div class="d-flex justify-content-between">
                        <span class="subAreaName">
                          {{subArea.name}} 
                        </span>
                        <span class="subAreaParentName">
                          {{subArea.parentName}}
                        </span>
                      </div>
                    </ng-option>
                </ng-select>
            </li>

            <li class="removeArrow">
              <ng-select 
                  [items]="items$ | async"
                  placeholder="Device ID"
                  (change)="onDeviceId($event)"
                  [(ngModel)]="selectedDeviceId"
                  id="confidentiality"
                  [ngClass]="{'goldenText': selectedDeviceId}"
                  [typeahead]="input$"
              >
                  <ng-option *ngFor="let region of deviceIds" [value]="region">
                    {{region}}
                  </ng-option>
              </ng-select>
            </li>

            <li>
              <ng-select placeholder="Device type"
                  (change)="onSelectDeviceType($event)"
                  [searchable]="true"
                  [clearable]="true"
                  [(ngModel)]="selectedDeviceType"
                  id="confidentiality"
                  [ngClass]="{'goldenText': selectedDeviceType}"
              >
                  <ng-option *ngFor="let subArea of deviceTypes" [value]="subArea">
                      {{subArea | titlecase}}
                  </ng-option>
              </ng-select>
            </li>
            <li>
              <ng-select placeholder="Format"
                  (change)="getAssetList()"
                  [searchable]="true"
                  [clearable]="true"
                  [(ngModel)]="selectedFormat"
                  id="confidentiality"
                  [ngClass]="{'goldenText': selectedFormat}"
              >
                  <ng-option *ngFor="let format of formats" [value]="format">
                      {{format}}
                  </ng-option>
              </ng-select>
            </li>

            <li>
              <mat-form-field appearance="fill" [ngClass]="{'goldenText': selectedStartDate || selectedEndDate}">
                <mat-label (click)="picker.open();">Enter a date range</mat-label>
                <mat-date-range-input (dateChange)="dateRangeChange()" [rangePicker]="picker" (click)="picker.open();" [max]="maxDate">
                  <input matinput (dateChange)="dateRangeChange()" class="customInput" matStartDate placeholder="Start date" [(ngModel)]="selectedStartDate">
                  <input matinput (dateChange)="dateRangeChange()" class="customInput" matEndDate placeholder="End date" [(ngModel)]="selectedEndDate">
                </mat-date-range-input>
                <mat-date-range-picker #picker></mat-date-range-picker>
                <span *ngIf="selectedStartDate || selectedEndDate" class="ng-clear-wrapper ng-star-inserted" title="Clear all" (click)="clearSelection()"
                style="color: #DEB31A !important;
                font-size: 20px;
                font-family: 'brownregular';
                position: absolute;
                top: -5px;
                right: 25px;
                cursor: pointer;"><span aria-hidden="true" class="ng-clear">Ã—</span></span>
              </mat-form-field>
              <!-- <button mat-button (click)="clearSelection()">Clear</button> -->
            </li>
            <!-- <li *ngIf="!isNeomUser()" style="width: auto;">
              <label class="control control--checkbox" style="margin-bottom: 0px;margin-top: 10px;">
                Only show assets uploaded by me
                <input (change)="getAssetList()" [(ngModel)]="assetByMe" type="checkbox" checked="checked"/>
                <div class="control__indicator"></div>
             </label>
            </li> -->
          </ul>
          <div *ngIf="!isNeomUser()" class="row">
            <div class="col-md-4">
              <label class="control control--checkbox" style="margin-bottom: 0px;">
                Only show assets uploaded by me
                <input (change)="getAssetList()" [(ngModel)]="assetByMe" type="checkbox" checked="checked"/>
                <div class="control__indicator"></div>
             </label>
            </div>
            <!-- <div class="col-md-4">
              <label class="control control--checkbox" style="margin-bottom: 0px;">
                Only show monthly videos
                <input type="checkbox" checked="checked"/>
                <div class="control__indicator"></div>
             </label>
            </div> -->
          </div>
        </div>


        <app-loader
          [show]="loading"
        ></app-loader>

        <ngx-masonry [options]="masonryOptions"
          (layoutComplete)="completeLoadingMasonry($event)"
          [updateLayout]="updateMasonryLayout">

          <div
            ngxMasonryItem
            class="masonry-item"
            [ngClass]="{'masonrZindex': masoneryItemIndex === i}"
            *ngFor="let doc of assetList; let i = index"
            (mouseover)="over(i)"
            (mouseout)="out()"
          >
            <document-card
              [doc]="doc"
              [viewType]="viewType"
              (onOpenPreview)="open(doc, doc.type)"
              (onSelect)="selectImage($event, doc, i)"
              (onMarkFavourite)="markFavourite(doc, 'recent')"
              [hasDownloadPermission]="checkAssetDownloadPermission(doc)"
            >
            </document-card>
          </div>
        </ngx-masonry>

        <div
          *ngIf="assetListDocument.isNextPageAvailable"
          (click)="showMore()"
          class="showMoreBtn"
        >
          Show more
        </div>

        <div class="no-asset" *ngIf="(!assetList || assetList.length == 0) && !checkNoFilterSelected()">
          No results found
        </div>
      </div>

      <preview-popup
        #previewModal
        [doc]="selectedFile"
        [docUrl]="selectedFileUrl"
      ></preview-popup>
  </div>
  <!-- <mat-paginator
        *ngIf="assetList?.length"
        #paginator
        [length]="resultCount"
        [pageSize]="defaultPageSize"
        [pageSizeOptions]="pageSizeOptions"
        (page)="paginatorEvent($event)"
        aria-label="Select page"
      >
    </mat-paginator> -->


    <div *ngIf="fileSelected.length" class="downloadAssets">
      <div class="selectedItems">
        Selected {{downloadCount}}
        <img src="../../assets/images/remove-icon.svg" alt="" (click)="removeAssets()" />
      </div>
      <div class="downloadSelectedAssets downloadFileWorkspace">
        <span (click)="multiDownload()"><img src="../../assets/images/download-golden.svg" alt="" /> Download
          selected assets</span>
        <div class="multiDownloadBlock">
          <div class="internal-use">
            <p *ngIf="copyRightItem.length>0">Always credit copyright owners.</p>
    
            <p class="pt-15" *ngIf="sizeExeeded" [ngClass]="{'removeMarginTop' : copyRightItem.length < 1 }">
              Your download exceeds 1 GB. This will likely take some time.
            </p>
            <p class="pt-15" *ngIf="needPermissionToDownload.length >0">
              {{ needPermissionToDownload.length }} asset{{ needPermissionToDownload.length>1 ?'s':'' }} in your selection
              require download permission. Contact approver(s) via email:
            </p>
    
            <ul class="downloadImgLisst" *ngIf="needPermissionToDownload.length > 0">
              <li *ngFor="let item of needPermissionToDownload">
                <div class="imgListBlk">
                  <img src="../../../assets/images/doc-white.svg" />
                </div>
                <div class="contentListBlk">{{ item.title }}</div>
                <div class="imgMailIcon">
                  <a href="mailto:{{ getUser(item) }}"><img src="../../../assets/images/mail-icon.svg" /></a>
                </div>
              </li>
            </ul>
            <div class="control-group"
              [ngClass]="{'error-disabled' : downloadErrorShow && !isAware, 'removeMarginTop' : !sizeExeeded &&  needPermissionToDownload.length<1}">
              <label class="control control--checkbox" *ngIf="forInternalUse.length>0">I'm aware certain selected asset(s)
                must NOT be used in public
                <input type="checkbox" [(ngModel)]="isAware" checked="isAware" (change)="onCheckboxChange($event)" />
                <div class="control__indicator"></div>
              </label>
            </div>
            <div class="error" *ngIf="downloadErrorShow && !isAware">
              Please check the box to proceed
            </div>
            <div class="download-btn" (click)="downloadClick()">
              <!-- <a (click)="removeAssets()" class="cancelDownload"
                >Cancel download</a
              > -->
              <a (click)="downloadAssets($event)"
                [ngClass]="{'downloadDisbable':!downloadEnable && forInternalUse.length > 0}"
                *ngIf="downloadArray.length>0">
                <svg width="22" height="21" viewBox="0 0 22 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M10.9673 19.5525V12.0525" stroke="#EDD580" stroke-width="1.5" stroke-linecap="round"
                    stroke-linejoin="round" />
                  <path d="M14.0923 16.7893L10.9673 19.9143L7.84229 16.7893" stroke="#EDD580" stroke-width="1.5"
                    stroke-linecap="round" stroke-linejoin="round" />
                  <path
                    d="M15.3748 14.1251H16.3123C18.0615 14.128 19.6161 13.0111 20.1715 11.3525C20.7269 9.69382 20.1582 7.86592 18.76 6.81503C17.3617 5.76414 15.4478 5.72622 14.009 6.72091C13.429 3.63287 10.6466 1.45547 7.50963 1.63483C4.37272 1.81418 1.8566 4.29453 1.63234 7.42855C1.40808 10.5626 3.5454 13.3759 6.62482 14.0001"
                    stroke="#EDD580" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                Download
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
</section>

<div class="addUserBlock">
  <!-- <h3>Who can have private access to this folder? -->
    <!-- <button type="button" class="close-modal-icon" aria-label="Close" (click)="closeModal()" style="float: right;">
      <img src="../../assets/images/close-modal.svg" style="width: 20px" />
   </button> -->
  <!-- </h3> -->
  <!-- <div (click)="openEditAccessModal()">test modal</div> -->
  <!-- <div class="addUsers" style="margin-bottom: 30px">
    <ng-select
      style="height: unset !important"
      [items]="userList$ | async"
      [multiple]="false"
      [hideSelected]="true"
      [trackByFn]="trackByFn"
      [minTermLength]="2"
      [loading]="userLoading"
      [(ngModel)]="selectedCollaborator"
      [typeahead]="userInput$"
      (change)="selectChange(selectedCollaborator)"
      placeholder="Add users by their name or email address"
      notFoundText="No user found"
    >
      <ng-template ng-option-tmp let-item="item">
        {{ item.id }} ({{ item.fullname }})
      </ng-template>
    </ng-select>
    <button class="addBtn">Add</button>
    <button (click)="sendInvite()" *ngIf="checkInviteExternal() && !checkNeomEmail()" class="sendInviteBtn">Send invite</button>
    <button (click)="sendInvite(true)" *ngIf="checkInviteExternal() && checkNeomEmail()" class="sendInviteBtn">Add</button>
  </div> -->

  <!-- <div class="makeAdminBlock">
    <ul>
      <li *ngFor="let c of addedCollaborators | keyvalue">
        {{ c.value.user.fullname || c.value.user.id }}
        <span *ngIf="c.value.permission === 'Everything'" class="disableColor pl-10">Admin</span>
        <span class="makeAdminAction">
          <span (click)="makeAdmin(c.key, 'added')" *ngIf="c.value.permission !== 'Everything' && !listExternalUser?.includes(c.value.user.id)">Make admin</span>
          <span (click)="removeAdmin(c.key, 'added')" *ngIf="c.value.permission === 'Everything' && !listExternalUser?.includes(c.value.user.id)">Remove admin</span>
          <span (click)="removeUser(c.key, 'added')" class="removeIcon">
            <svg
              width="20"
              height="20"
              viewBox="0 0 20 20"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M10 20C4.477 20 0 15.523 0 10C0 4.477 4.477 0 10 0C15.523 0 20 4.477 20 10C20 15.523 15.523 20 10 20ZM10 18C12.1217 18 14.1566 17.1571 15.6569 15.6569C17.1571 14.1566 18 12.1217 18 10C18 7.87827 17.1571 5.84344 15.6569 4.34315C14.1566 2.84285 12.1217 2 10 2C7.87827 2 5.84344 2.84285 4.34315 4.34315C2.84285 5.84344 2 7.87827 2 10C2 12.1217 2.84285 14.1566 4.34315 15.6569C5.84344 17.1571 7.87827 18 10 18ZM10 8.586L12.828 5.757L14.243 7.172L11.414 10L14.243 12.828L12.828 14.243L10 11.414L7.172 14.243L5.757 12.828L8.586 10L5.757 7.172L7.172 5.757L10 8.586Z"
                fill="#937206"
              />
            </svg>
            <div class="removeInfo">Remove user</div>
          </span>
        </span>
      </li>
      <li *ngFor="let c of internalCollaborators | keyvalue">
        {{ getUsername(c.value) }}
        <span *ngIf="c.value.permission === 'Everything'" class="disableColor pl-10">Admin</span>
        <span class="makeAdminAction">
          <span (click)="makeAdmin(c.key, 'updated')" *ngIf="c.value.permission !== 'Everything' && !listExternalUser?.includes(c.value.user.id)">Make admin</span>
          <span (click)="removeAdmin(c.key, 'updated')" *ngIf="c.value.permission === 'Everything' && canRemoveAdmin(c.value) && !listExternalUser?.includes(c.value.user.id)">Remove admin</span>
          <span (click)="removeUser(c.key, 'removed')" *ngIf="canRemoveAdmin(c.value)" class="removeIcon">
            <svg
              width="20"
              height="20"
              viewBox="0 0 20 20"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M10 20C4.477 20 0 15.523 0 10C0 4.477 4.477 0 10 0C15.523 0 20 4.477 20 10C20 15.523 15.523 20 10 20ZM10 18C12.1217 18 14.1566 17.1571 15.6569 15.6569C17.1571 14.1566 18 12.1217 18 10C18 7.87827 17.1571 5.84344 15.6569 4.34315C14.1566 2.84285 12.1217 2 10 2C7.87827 2 5.84344 2.84285 4.34315 4.34315C2.84285 5.84344 2 7.87827 2 10C2 12.1217 2.84285 14.1566 4.34315 15.6569C5.84344 17.1571 7.87827 18 10 18ZM10 8.586L12.828 5.757L14.243 7.172L11.414 10L14.243 12.828L12.828 14.243L10 11.414L7.172 14.243L5.757 12.828L8.586 10L5.757 7.172L7.172 5.757L10 8.586Z"
                fill="#937206"
              />
            </svg>
            <div class="removeInfo">Remove user</div>
          </span>
        </span>
      </li>
    </ul>
  </div> -->



  <!-- NOTE: new UI for lock folder -->
    <div>
      <div class="makeAdminBlock customTableStyle">
        <div class="whenYouConvert">
          This folder contains assets from other users. By default, they will have access to this locked folder.
        </div>

        <h4>People with access</h4>
        <p>This is the selected group of individual people inside or outside of NEOM. </p>

        <div class="searchBlock">
          <span class="positionRelative">
            <ng-select
              style="height: unset !important"
              [items]="userList$ | async"
              [multiple]="false"
              [hideSelected]="true"
              [trackByFn]="trackByFn"
              [minTermLength]="2"
              [loading]="userLoading"
              [(ngModel)]="selectedCollaborator"
              [typeahead]="userInput$"
              (change)="selectChange(selectedCollaborator)"
              placeholder="Add users by their name or email address"
              notFoundText="No user found"
            >
              <ng-template ng-option-tmp let-item="item">
                {{ item.id }} ({{ item.fullname }})
              </ng-template>
            </ng-select>
          </span>
        </div>

        <table class="folderListview" style="width: calc(100% - 6px);">
          <tr>
              <th style="width:50%">Users</th>
              <th style="width:15%">Role</th>
              <th style="width:30%">Permissions</th>
              <th style="width:14%">Access expiry</th>
              <th style="width:40px"></th>
          </tr>
        </table>
        <div class="overflowHidden">
          <table class="folderListview">
            <tr *ngFor="let collaborator of internalCollaborators | keyvalue">
              <td style="width:50%">
                <div class="tollTipCustom">
                  <div class="itemTitleContent">{{ getUsername(collaborator.value) }}
                    <span>(You)</span>
                    <span class="accessExpired">Access expired</span>
                  </div>
                </div>
              </td>
              <td class="bold" style="width:15%">
                <span>Owner</span>
              </td>
              <td 
                *ngIf="collaborator.value.permission !== 'Everything' && !listExternalUser?.includes(collaborator.value.user.id)" 
                class="bold" 
                style="width:15%">
                <span 
                  (click)="makeAdmin(collaborator.key, 'updated')" 
                  class="makeAdminClick">
                  Make admin
                </span>
              </td>
              <td class="bold" style="width:15%">
                <span>Admin</span>
                <div 
                  *ngIf="collaborator.value.permission === 'Everything' && canRemoveAdmin(collaborator.value) && !listExternalUser?.includes(collaborator.value.user.id)"
                  (click)="removeAdmin(collaborator.key, 'updated')" 
                  class="tollTipCustom" 
                  style="display: inline-block">
                  <div class="itemTitleContent inlineBlock"><img src="../../assets/images/close-makeAdmin.svg" class="makeAdminIcon" /></div>
                  <div class="tolltipContent alignRight">Remove admin role</div>
                </div>
              </td>
              <td class="makePrivate bold" style="width:30%">
                <ul class="permission">
                  <li>
                    <label class="control control--checkbox">
                      Upload
                      <input type="checkbox" checked />
                      <div class="control__indicator"></div>
                    </label>
                  </li>
                  <li>
                    <label class="control control--checkbox">
                      Download
                      <input type="checkbox" checked />
                      <div class="control__indicator"></div>
                    </label>
                  </li>
                </ul>
              </td>
              <td class="accessExpiryCal bold accessExpiredDate" style="width:14%">
                <mat-form-field appearance="fill">
                  <input class="datePicker" placeholder="3.29.2023" matInput [matDatepicker]="picker" style="width: 100%; border-bottom: 1.5px solid #000;" (click)="picker.open()">
                  <mat-datepicker #picker></mat-datepicker>
              </mat-form-field>
              </td>
              <td style="width:40px">
                <svg 
                  *ngIf="canRemoveAdmin(collaborator.value)"
                  (click)="removeUser(collaborator.key, 'removed')" width="16" height="18" viewBox="0 0 16 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="action-delete-icon">
                  <path d="M1.16724 5.24465L14.8612 2.33398" stroke="#937206" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <path fill-rule="evenodd" clip-rule="evenodd" d="M9.06662 1.52163L6.13329 2.14497C5.87313 2.19969 5.64547 2.35575 5.50061 2.57867C5.35575 2.80158 5.30562 3.07301 5.36129 3.33297L5.56929 4.31163L10.46 3.27163L10.252 2.29363C10.1972 2.03404 10.0415 1.80685 9.81923 1.66206C9.59692 1.51727 9.32619 1.46675 9.06662 1.52163Z" stroke="#937206" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M7.16724 13V8" stroke="#937206" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M10.1672 13V8" stroke="#937206" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M12.4172 5H14.1672L13.2439 15.5827C13.2008 16.1024 12.7655 16.5018 12.2439 16.5H5.08724C4.56722 16.4997 4.13422 16.1009 4.09124 15.5827L3.3999 7.25133" stroke="#937206" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </td>
            </tr>
            <!-- <tr>
              <td>
                <div class="tollTipCustom">
                  <div class="itemTitleContent">zimraan.hadi@example.com <span class="accessExpired">Access expired</span></div>
                
                </div>
              </td>
              <td class="bold">
                <span class="makeAdminClick">Make admin</span>
              </td>
              <td class="makePrivate bold">
                <ul class="permission">
                  <li>
                    <label class="control control--checkbox">
                      Upload
                      <input type="checkbox" checked />
                      <div class="control__indicator"></div>
                    </label>
                  </li>
                  <li>
                    <label class="control control--checkbox">
                      Download
                      <input type="checkbox" checked />
                      <div class="control__indicator"></div>
                    </label>
                  </li>
                </ul>
              </td>
              <td class="accessExpiryCal bold accessExpiredDate">
                <mat-form-field appearance="fill">
                    <input class="datePicker" placeholder="3.29.2023" matInput [matDatepicker]="picker" style="width: 100%; border-bottom: 1.5px solid #000;" (click)="picker.open()">
                    <mat-datepicker #picker></mat-datepicker>
                </mat-form-field>
              </td>
              <td>
                <svg width="16" height="18" viewBox="0 0 16 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="action-delete-icon">
                  <path d="M1.16724 5.24465L14.8612 2.33398" stroke="#937206" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <path fill-rule="evenodd" clip-rule="evenodd" d="M9.06662 1.52163L6.13329 2.14497C5.87313 2.19969 5.64547 2.35575 5.50061 2.57867C5.35575 2.80158 5.30562 3.07301 5.36129 3.33297L5.56929 4.31163L10.46 3.27163L10.252 2.29363C10.1972 2.03404 10.0415 1.80685 9.81923 1.66206C9.59692 1.51727 9.32619 1.46675 9.06662 1.52163Z" stroke="#937206" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M7.16724 13V8" stroke="#937206" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M10.1672 13V8" stroke="#937206" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M12.4172 5H14.1672L13.2439 15.5827C13.2008 16.1024 12.7655 16.5018 12.2439 16.5H5.08724C4.56722 16.4997 4.13422 16.1009 4.09124 15.5827L3.3999 7.25133" stroke="#937206" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </td>
            </tr> -->
            <!-- <tr>
              <td>
                <div class="tollTipCustom">
                  <div class="itemTitleContent">azeem.ahmadi@example.com</div>
                </div>
              </td>
              <td class="bold">
                <span class="makeAdminClick">Make admin</span>
              </td>
              <td class="makePrivate bold">
                <ul class="permission">
                  <li>
                    <label class="control control--checkbox">
                      Upload
                      <input type="checkbox" />
                      <div class="control__indicator"></div>
                    </label>
                  </li>
                  <li>
                    <label class="control control--checkbox">
                      Download
                      <input type="checkbox" checked />
                      <div class="control__indicator"></div>
                    </label>
                  </li>
                </ul>
              </td>
              <td class="accessExpiryCal bold">
                <mat-form-field appearance="fill">
                    <input class="datePicker" placeholder="3/29/2023" matInput [matDatepicker]="picker3" style="width: 100%; border-bottom: 1.5px solid #000;" (click)="picker.open()">
                    <mat-datepicker #picker3></mat-datepicker>
                </mat-form-field>
              </td>
              <td>
                <svg width="16" height="18" viewBox="0 0 16 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="action-delete-icon">
                  <path d="M1.16724 5.24465L14.8612 2.33398" stroke="#937206" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <path fill-rule="evenodd" clip-rule="evenodd" d="M9.06662 1.52163L6.13329 2.14497C5.87313 2.19969 5.64547 2.35575 5.50061 2.57867C5.35575 2.80158 5.30562 3.07301 5.36129 3.33297L5.56929 4.31163L10.46 3.27163L10.252 2.29363C10.1972 2.03404 10.0415 1.80685 9.81923 1.66206C9.59692 1.51727 9.32619 1.46675 9.06662 1.52163Z" stroke="#937206" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M7.16724 13V8" stroke="#937206" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M10.1672 13V8" stroke="#937206" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M12.4172 5H14.1672L13.2439 15.5827C13.2008 16.1024 12.7655 16.5018 12.2439 16.5H5.08724C4.56722 16.4997 4.13422 16.1009 4.09124 15.5827L3.3999 7.25133" stroke="#937206" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </td>
            </tr> -->
          </table>
        </div>
      </div>
    </div>

    <div class="makeAdminBlock" *ngIf="checkShowExternalUser()">
      <h3 style="color: grey;">External users</h3>
      <ul style="min-height: auto;">
        <li *ngFor="let c of invitedCollaborators | keyvalue">
          {{getExternalName(c.value)}}
          <span class="disableColor pl-10">Pending - Access expires {{getEndDate(c.value.end)}}</span>
          <span class="makeAdminAction">
            <span  (click)="open(mymodal, c.value)">Edit Access</span><!-- open(mymodal, c.value) -->
            <span (click)="removeUser(c.key, 'invited')" class="removeIcon">
              <svg
                width="20"
                height="20"
                viewBox="0 0 20 20"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M10 20C4.477 20 0 15.523 0 10C0 4.477 4.477 0 10 0C15.523 0 20 4.477 20 10C20 15.523 15.523 20 10 20ZM10 18C12.1217 18 14.1566 17.1571 15.6569 15.6569C17.1571 14.1566 18 12.1217 18 10C18 7.87827 17.1571 5.84344 15.6569 4.34315C14.1566 2.84285 12.1217 2 10 2C7.87827 2 5.84344 2.84285 4.34315 4.34315C2.84285 5.84344 2 7.87827 2 10C2 12.1217 2.84285 14.1566 4.34315 15.6569C5.84344 17.1571 7.87827 18 10 18ZM10 8.586L12.828 5.757L14.243 7.172L11.414 10L14.243 12.828L12.828 14.243L10 11.414L7.172 14.243L5.757 12.828L8.586 10L5.757 7.172L7.172 5.757L10 8.586Z"
                  fill="#937206"
                />
              </svg>
              <div class="removeInfo">Remove user</div>
            </span>
          </span>
        </li>
        <li *ngFor="let c of addedExternalUsers | keyvalue">
          {{getExternalName(c.value)}}
          <span class="disableColor pl-10"><span *ngIf="c.value.externalUser">Pending - </span>Access expires {{getEndDate(c.value.end)}}</span>
          <span class="makeAdminAction">
            <span (click)="open(mymodal, c.value)">Edit Access</span>
            <span (click)="removeUser(c.key, 'added')" class="removeIcon">
              <svg
                width="20"
                height="20"
                viewBox="0 0 20 20"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M10 20C4.477 20 0 15.523 0 10C0 4.477 4.477 0 10 0C15.523 0 20 4.477 20 10C20 15.523 15.523 20 10 20ZM10 18C12.1217 18 14.1566 17.1571 15.6569 15.6569C17.1571 14.1566 18 12.1217 18 10C18 7.87827 17.1571 5.84344 15.6569 4.34315C14.1566 2.84285 12.1217 2 10 2C7.87827 2 5.84344 2.84285 4.34315 4.34315C2.84285 5.84344 2 7.87827 2 10C2 12.1217 2.84285 14.1566 4.34315 15.6569C5.84344 17.1571 7.87827 18 10 18ZM10 8.586L12.828 5.757L14.243 7.172L11.414 10L14.243 12.828L12.828 14.243L10 11.414L7.172 14.243L5.757 12.828L8.586 10L5.757 7.172L7.172 5.757L10 8.586Z"
                  fill="#937206"
                />
              </svg>
              <div class="removeInfo">Remove user</div>
            </span>
          </span>
        </li>
        <li *ngFor="let c of externalCollaborators | keyvalue">
          {{getExternalName(c.value)}}
          <span class="disableColor pl-10"><span *ngIf="c.value.externalUser">Pending - </span>Access expires {{getEndDate(c.value.end)}}</span>
          <span class="makeAdminAction">
            <span (click)="open(mymodal, c.value)">Edit Access</span>
            <span (click)="removeUser(c.key, 'removed')" class="removeIcon">
              <svg
                width="20"
                height="20"
                viewBox="0 0 20 20"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M10 20C4.477 20 0 15.523 0 10C0 4.477 4.477 0 10 0C15.523 0 20 4.477 20 10C20 15.523 15.523 20 10 20ZM10 18C12.1217 18 14.1566 17.1571 15.6569 15.6569C17.1571 14.1566 18 12.1217 18 10C18 7.87827 17.1571 5.84344 15.6569 4.34315C14.1566 2.84285 12.1217 2 10 2C7.87827 2 5.84344 2.84285 4.34315 4.34315C2.84285 5.84344 2 7.87827 2 10C2 12.1217 2.84285 14.1566 4.34315 15.6569C5.84344 17.1571 7.87827 18 10 18ZM10 8.586L12.828 5.757L14.243 7.172L11.414 10L14.243 12.828L12.828 14.243L10 11.414L7.172 14.243L5.757 12.828L8.586 10L5.757 7.172L7.172 5.757L10 8.586Z"
                  fill="#937206"
                />
              </svg>
              <div class="removeInfo">Remove user</div>
            </span>
          </span>
        </li>
      </ul>
    </div>

    <!-- <div class="makePrivate tollTipWorkspace">
      <label class="control control--checkbox mb-20">
        Entire department
        <span class="disableColor"
          >Everyone in your department can access this private folder</span
        >
        <input type="checkbox" />
        <div class="control__indicator"></div>
      </label>

      <label class="control control--checkbox">
        Anyone from NEOM
        <span class="disableColor"
          >Everyone with a @neom.com account can access this private folder</span
        >
        <input type="checkbox" />
        <div class="control__indicator"></div>
      </label>
    </div> -->
  <!-- </div> -->
  <div class="button-groups">
    <button (click)="closeModal()" class="cancel-btn">Cancel</button>
    <button *ngIf="!doneLoading" (click)="updateCollaborators()" [ngClass]="canSave() ? 'upload-btn' : 'upload-btn disabled'" class="upload-btn">Done</button>
    <button *ngIf="doneLoading" class="upload-btn" style="position: relative;     position: relative;
    height: 36px;
    padding: 0px;
    overflow: hidden;"><app-loader-small [show]="loading"></app-loader-small></button>
  </div>


  <ng-template #mymodal let-modal>
    <div class="modalContentBlock" style="position: relative;">
      <div class="addUserBlock">
        <h3>Edit access</h3>
        <ul class="mb-20">
          <li>
            {{selectedExternalUser.user.id}}
            <span class="disableColor pl-10"><span *ngIf="selectedExternalUser.externalUser">Pending - </span>Access expires {{getEndDate(selectedExternalUser.end)}}</span>
          </li>
        </ul>
        <div class="makePrivate tollTipWorkspace">
          <div class="row mb-20">
            <div class="col-md-3">
              Access scope
            </div>
            <div class="col-md-9">
              <ol>
                <li>
                  <label class="control control--checkbox mb-10" style="width: calc(100% - 31px);">
                    This folder
                    <input type="radio" [checked]="!isGlobal" (change)="onFullAccessCheckboxChange($event, false)"/>
                    <div class="control__indicator"></div>
                  </label>
                  <span class="removeIcon" style="position: relative;">
                    <img src="../../assets/images/Info-icon.svg" />
                    <div class="removeInfo" style="bottom: -30px;">Remove user</div>
                  </span>
                </li>
                <li>
                  <label class="control control--checkbox">
                    Full site access to all public assets
                    <input type="radio" [checked]="isGlobal" (change)="onFullAccessCheckboxChange($event)"/>
                    <div class="control__indicator"></div>
                  </label>
                </li>
              </ol>
            </div>
          </div>

          <div class="row">
            <div class="col-md-3">
              Access expiry
            </div>
            <div class="col-md-9">
              <span style="width: calc(100% - 31px);display: inline-block;">
                <!-- <input type="date" id="birthday" name="birthday"> -->
                <mat-form-field appearance="fill">
                  <input matInput  [matDatepicker]="picker" style="width: 100%; border-bottom: 1.5px solid #000;"
                  [(ngModel)]="selectedMonth" (click)="picker.open()"  [ngClass]="{'goldenText': selectedMonth}">
                  <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                  <mat-datepicker #picker></mat-datepicker>
                </mat-form-field>

                <!-- <ng-select [items]="month"
                  bindLabel="name"
                  bindValue="id"
                  placeholder="Select month"
                  [(ngModel)]="selectedMonth"
                  (change)="selectDuration(selectedMonth)">
                </ng-select> -->
              </span>
              <span class="removeIcon" style="position: relative;">
                <img src="../../assets/images/Info-icon.svg" />
                <div class="removeInfo" style="bottom: -30px;">Remove user</div>
              </span>
            </div>
          </div>
        </div>
      </div>

      <div class="button-groups">
        <button (click)="modal.close('cancel')" class="cancel-btn">Cancel</button>
        <button (click)="modal.close('done')" class="upload-btn">Done</button>
      </div>
    </div>
  </ng-template>
